## NB-IoT省电参数配置

## 1 能耗

NB-IoT 正常功耗低于 WiFi，同时提供多种网络在线模式——类似手机的 待机模式（DRX 模式）、省电待机（eDRX 模式）、节电模式（PSM 模式），智能家电可依据自身功耗需求选择和转换在线模式以满足智能家电未来越来越严苛的节能、环保要求。

## 2 三种省电模式

### 2.1 PSM (省电模式) 

终端非业务期间深度休眠，不接收下行数据，只有 **终端主动发送上行数据（MO Data）时可接收IoT平台缓存的下行数据** ，适合对下行数据无时延要求的业务；终端设备功耗低，采取电池供电方式，如抄表业务。 

**PSM模式示意图：**

![](NB_iamge\u380.png)

**三种状态之间的转换关系：** 

![](NB_iamge\u386.png)

- 终端设备发送上行数据（Mo Data）或周期性位置更新（Periodic TAU）时，设备状态进入Connected State。
- 在Connected长时间无消息收发，如基站定时器超时或终端上报上行数据时，携带不需要返回下行数据标识时，设备进入Idle State。
- 在Idle State时，如果设备的Active timer超时，则会进入到PSM State，直到下一次的主动发送上行数据（Mo Data）或周期性位置更新（Periodic TAU）才会改变其状态。

### 2.2 DRX 

可以认为下行业务随时可达终端设备，在每个DRX周期（ 1.28s，2.56s，5.12s 或者10.24s ），终端都会检测一次是否有下行业务到达，适用于对时延有高要求的业务。终端设备一般采取供电的方式，如路灯业务。 

**DRX模式示意图：** 

![](NB_iamge\u396.png)

- 由于DRX周期短（ 1.28s，2.56s，5.12s 或者10.24s，由运营商网络侧设置决定），可认为下行业务随时可达，时延小。
- 适用于对时延有高要求的业务，但功耗相对较高，终端设备一般采用供电方式。

### 2.3 eDRX (延长 DRX) 

终端设备兼顾低功耗和对时延有一定要求的业务，在每个eDRX周期内，只有在设置的寻呼时间窗口内，终端可接收下行数据，其余时间终端处于休眠状态，不接收下行数据，该模式可在下行业务时延和功耗之间取得平衡，如远程关闭煤气业务。 

**eDRX模式示意图：** 

![](NB_iamge\u400.png)

- 每个eDRX周期内，有一个寻呼时间窗口PTW（ Paging Time Window ），终端在PTW内按照DRX周期（DRX周期时间短，可以认为终端不休眠、一直可达）监听寻呼信道，以便接收下行数据，其余时间终端处于休眠状态。
- eDRX模式可以认为终端设备随时可达，但时延较大，时延取决于eDRX周期配置，可以在低功耗与时延之间取得平衡。

## 3 NB-IoT参数配置

**IoT平台上的省电模式和物联网卡的 APN 设置保持一致；若设置了 ACTIVE TIMER 参数则表示 启用 PSM 模式；若仅设置了 eDRX 周期则表示启用 EDRX 模式；若两个参数都不设置则表示启用 DRX 模式。**

- **功能介绍 :** 平台在下发数据到终端设备时，需要根据终端的省电模式来优化消息的下发和重传的策略，由于设备的省电模式是在运营商的网络侧进行设置的，平台无法从终端设备和网络侧获取到设备的省电模式，所以需要您把终端设备的省电模式配置到平台。 
- **省电模式说明 :** IoT平台配置的省电模式需要与运营商网络侧的配置保持一致，您可以联系网络提供商查询获取。 

### 3.1 IoT平台省电设置

目前平台支持设置三种模式，分别为 DRX 模式（Discontinuous Reception ， 不连续接收模式），EDRX 模式（Extended Idle Mode DRX，扩展不连续接收模 式）及 PSM 模式（Power Saving Mode，省电模式）。如果 NB-IoT 设置没配置 （即“自定义省电模式配置参数”未勾选），则默认设备的模式认为 PSM 模式。 若启用了“自定义省电模式配置参数”，则用户根据 ACTIVE TIMER 和 eDRX 周期两个参数设置设备的模式。

- 这里两个参数的设置要与网络侧保持一致，在IoT平台上参数的设置只是配置到 IoT 网关中，不会配置到网络或者设备。对于下行网络时延有要求的，请使用 DRX 模式，请勿配置 eDRX 及 PSM 参数。 

### 3.2 nb-iot模组省电模式配置

对于nb-iot模组的省电模式可以在初始化的时候用AT命令对模组进行设置，AT+CPSMS可以设置终端是否进入PSM模式，如果设置为不使用PSM则不会进入PSM，可以随时接收数据。AT+CEDRXS可以使能或禁用eDRX模式。 